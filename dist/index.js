"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,s=[],o=!0,u=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(s.push(r.value),!e||s.length!==e);o=!0);}catch(t){u=!0,i=t}finally{try{o||null==n.return||n.return()}finally{if(u)throw i}}return s}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var u;Object.defineProperty(exports,"__esModule",{value:!0}),function(t){t[t.EMPTY=0]="EMPTY",t[t.WAIT=1]="WAIT",t[t.LOADING=2]="LOADING",t[t.FINISH=3]="FINISH"}(u||(u={}));var a=function(){function s(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t(this,s),n(this,"initEnums",void 0),n(this,"innerEnums",void 0),n(this,"symbols",void 0),n(this,"innerGetters",void 0),n(this,"gettersCondition",void 0),n(this,"subscriptions",void 0),n(this,"fetchEnumCallback",void 0),n(this,"state",void 0),this.initEnums=r,this.symbols={},this.innerEnums=i(r),this.innerGetters={},this.gettersCondition={},this.subscriptions=[],this.fetchEnumCallback=function(){return Promise.resolve([])},this.state=u.EMPTY,Object.defineProperty(this,"enums",{get:function(){return e.load(),e.innerEnums},set:function(){throw new Error("不能更改暴露的参数")}}),Object.defineProperty(this,"getters",{get:function(){return e.load(),e.innerGetters},set:function(){throw new Error("不能更改暴露的参数")}})}var o,a,c;return o=s,(a=[{key:"setSymbols",value:function(t){var e=this;if(!Object.values(t).every((function(t){return e.initEnums.some((function(e){var n=e.id;return t===n}))})))throw new RangeError("设置的标记必须在初始枚举中能够找到");return Object.assign(this.symbols,t),this}},{key:"setGetters",value:function(t){var e=this;return Object.keys(t).forEach((function(t){e.innerGetters[t]=[]})),Object.assign(this.gettersCondition,t),this.updateGetters(this.innerEnums),this}},{key:"updateGetters",value:function(t){var e=this;Object.entries(this.gettersCondition).forEach((function(n){var i=r(n,2),s=i[0],o=i[1],u=t.filter((function(t){return o.call(e,t)}));e.innerGetters[s].splice(0,e.innerGetters[s].length),u.forEach((function(t){return e.innerGetters[s].push(t)}))}))}},{key:"setSubscribe",value:function(t){return this.subscriptions.push(t),this}},{key:"updateEnums",value:function(t){var e=this;if(!this.initEnums.every((function(e){return t.some((function(t){return e.id===t.id&&e.value===t.value}))})))throw new RangeError("更新的枚举不包含初始枚举");return this.innerEnums.splice(0,this.innerEnums.length),t.forEach((function(t){return e.innerEnums.push(t)})),this.updateGetters(t),this.subscriptions.forEach((function(t){t(e.innerEnums)})),this}},{key:"setFetchEnumsCallback",value:function(t){return this.state=u.WAIT,this.fetchEnumCallback=t,this}},{key:"promiseGetFetchEnums",value:function(){var t=this;return new Promise((function(e){[u.EMPTY,u.FINISH].includes(t.state)?e(t.innerEnums):(t.setSubscribe(e),t.load())}))}},{key:"load",value:function(){var t=this;this.state===u.WAIT&&(this.state=u.LOADING,this.fetchEnumCallback().then((function(e){t.updateEnums(e),t.state=u.FINISH})).catch((function(e){throw t.state=u.WAIT,e})))}}])&&e(o.prototype,a),c&&e(o,c),Object.defineProperty(o,"prototype",{writable:!1}),s}();exports.EnumsManager=a;
